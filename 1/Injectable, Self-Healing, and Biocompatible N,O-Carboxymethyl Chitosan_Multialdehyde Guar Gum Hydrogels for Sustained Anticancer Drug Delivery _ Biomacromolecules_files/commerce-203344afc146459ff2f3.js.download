(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{281:function(e,s,t){"use strict";t.r(s);t(282),t(283),t(284),t(285),t(286);s.default=function main(e){var s=document.getElementById("guestButtonID"),t=Array.prototype.slice.call(document.querySelectorAll(".access-denial-widget-container,.seamless-access-btn-container")),n=Array.prototype.slice.call(document.getElementsByClassName("eCommerceCheckoutIdentityWidget"));try{s&&e.cartScrollTop.init(s)}catch(e){console.error(e)}try{t.length&&e.accessDenial.init(t)}catch(e){console.error(e)}try{n.length&&e.returnUser.init(n)}catch(e){console.error(e)}}},282:function(e,s){var t={page:{}};t.page.cart={}},283:function(e,s){var t;t={$findGuestButton:"#guestButtonID",init:function init(){t.controller()},controller:function controller(){$("body").delegate(t.$findGuestButton,"click",(function(){window.scrollTo(0,0)}))}},UX.cartScrollTop=t},284:function(e,s){var t;t={$body:$("body"),$indCont:$(".access-ind"),$moreOptionsButton:$(".access_more-options"),$loginLinkAccessDenial:$(".accessDenialWidget a.login-btn"),$form:$('form[name="slotLicenceConfirmationMessage"]'),$pubDoi:$(".pub-doi"),$purchseUrl:"",newDenialPurchaseCard:document.querySelector(".access-denials__option.purchase-access"),seamlessAccessCardHeader:document.querySelector(".seamless-access-btn-container h3"),newDenialsWrapper:document.querySelector(".newDenial"),eulaDiv:document.querySelector(".eulaLayer"),recommendedSection:null,animationTimer:null,firstCardChild:null,cardsHeight:null,caseNumber:null,recommendedChildIndex:null,staticTexts:{instNoAccess:"INST-NO-ACCESS",NoInst:"NO-INST",instGiveAccess:"INST-ACCESS",isDesktop:window.matchMedia("(max-width: ".concat(UX.grid.screenMd,"px)")).matches,isMobile:window.matchMedia("(max-width: ".concat(UX.grid.screenXs,"px")).matches,instName:"",hiddenClass:"hidden",recommendedUrl:"https://access.acspubs.org/recommend?ref=",recommendedLabel:"Recommend Publication",accessNotProvidedLabel:"Access is not provided via",containerBreakPoint:960},init:function init(){t.control(),t.initializeMemberBenefitsAndPPVs(),t.initSeamlessAccess(),t.moveSeamlessAccessBtnToHeader(),t.hideRestoreAccessLink(),screen.orientation.addEventListener("change",t.handleOrientationChange.bind(this))},control:function control(){t.$body.on("click",".access_more-options",(function(e){e.preventDefault(),$(this).hasClass("access_more-options_opened")?t.$indCont.slideUp():t.$indCont.slideDown(),$(this).toggleClass("access_more-options_opened")})),$(t.$form).submit((function(e){!0===$(t.$form).data("submitted")&&e.preventDefault(),$(".confirmSlotLicenceSubmit").attr("disabled","disabled")})),t.$loginLinkAccessDenial.length>0&&t.$loginLinkAccessDenial.on("click",(function(){UX.userLogin.saveCurrentUrlCookie()})),t.registerEulaRejectOnClick()},initializeMemberBenefitsAndPPVs:function initializeMemberBenefitsAndPPVs(){0!==$(".access-denial-widget-container").length&&(this.populatePurchaseAccessBtnHref(),this.populateMemberBenefitsBtnHref())},populatePurchaseAccessBtnHref:function populatePurchaseAccessBtnHref(){var e,s,t,n,i=$(".accessDenialWidget .ind-user-exists");0!==i.length&&0!==(e=$(i[0]).find(".ppv-offers a.add-article-to-cart").filter((function(){return"#"!==$(this).attr("href")&&""!==$(this).attr("href")}))).length&&(s=$(e[0]),0!==(t=i.find("a.purchase-access")).length&&(n=s[0],t.on("click",(function(){$(n).trigger("click")}))))},populateMemberBenefitsBtnHref:function populateMemberBenefitsBtnHref(){var e,s,t,n=$(".accessDenialWidget .ind-user-exists");0!==n.length&&(e=$(n[0]).find(".allowance-hidden-link").attr("href"),(s=$(n[0]).find(".member-benefits-notes-link")).length>0&&s.attr("href",e),(t=$(n[0]).find(".use-member-benefits")).length>0&&t.attr("href",e))},textInputFieldTyping:function textInputFieldTyping(){var e=$(".text-input-field").find(":input").val();t.isNullOrWhitespace(e)?($(".text-input-validation").removeClass("hidden"),$(".confirmSlotLicenceSubmit")[0].setAttribute("disabled","disabled")):($(".text-input-validation").addClass("hidden"),$(".confirmSlotLicenceSubmit")[0].removeAttribute("disabled"))},isNullOrWhitespace:function isNullOrWhitespace(e){return!e||0===e.trim().length},validateSlotLicenceConfirmationMessageForm:function validateSlotLicenceConfirmationMessageForm(){var e=$(".text-input-field").find(":input").val();return t.isNullOrWhitespace(e)?($(".slotLicenceConfirmationMessage").disabled=!0,!1):($(".slotLicenceConfirmationMessage").disabled=!1,!0)},registerEulaRejectOnClick:function registerEulaRejectOnClick(){if(t.eulaDiv){var e=document.querySelector(".access-denials__option .internalNav"),s=t.eulaDiv.querySelector(".eula-reject-terms");null==s||s.addEventListener("click",t.toggleEulaSection),null==e||e.addEventListener("click",(function(e){return t.toggleEulaSection(e,!1)}))}},toggleEulaSection:function toggleEulaSection(e){var s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.preventDefault(),s?t.eulaDiv.classList.add(t.staticTexts.hiddenClass):t.eulaDiv.classList.remove(t.staticTexts.hiddenClass)},getDeprecatedIDs:function getDeprecatedIDs(e){var s=[];$.ajax({type:"GET",url:"/pb-assets/SeamlessAccess/oldentityids.json",dataType:"json",success:function success(t){s=t.IdPs.map((function(e){return decodeURIComponent(e.Entity_ID_old)})),e(s)},error:function error(){e(s)}})},removeEntityFromLocalStorage:function removeEntityFromLocalStorage(e){SeamlessAccessService.removeEntity(e)},removingDeprecatedIdPs:function removingDeprecatedIdPs(e,s){0===e.length&&s(e),t.getDeprecatedIDs((function(n){var i,c,a=[];for(0===n.length&&s(e),i=0;i<e.length;i++)c=e[i],n.includes(c.entityID)?t.removeEntityFromLocalStorage(c.entityID):a.push(c);s(a)}))},initSeamlessAccess:function initSeamlessAccess(){var e,s,n;0!==$(".seamless-access-btn").length&&SeamlessAccessService&&0!==t.$pubDoi.length&&(null===(e=(s=window).ga)||void 0===e||e.call(s,"send","event","Federated Access Impressions","Impression","Seamless Access Icon Impressions"),t.startLoading(),n=t.$pubDoi.val(),SeamlessAccessService.getEntitiesWithAllInfo(n).then((function(e){t.removingDeprecatedIdPs(e,(function(e){var s;if(0!==e.length){switch((s=e[e.length-1]).entityStatusObj.code){case 1001:t.institutionDidNotProvideAccess(s,"ENTITY_ID_NOT_SUPPORTED");break;case 1002:t.institutionDidNotProvideAccess(s,"ENTITY_ID_CANNOT_PROVIDE_ACCESS");break;case 1003:t.institutionProvideAccess(s,"ENTITY_ID_PROVIDE_ACCESS");break;case 1004:t.institutionProvideAccess(s,"ENTITY_ID_MAY_PROVIDE_ACCESS")}t.caseNumber=s.entityStatusObj.code,t.newDenialPurchaseCard&&t.showPurchaseAccessBtn(),t.setControlsMinHeight()}else t.handleNoInstitutions()}))}),(function(e){t.handleNoInstitutions()})))},removeStates:function removeStates(){$(".seamless-access-btn").removeClass("state-default"),$(".seamless-access-btn").removeClass("state-no-institutions"),$(".seamless-access-btn").removeClass("state-inst-did-not-provide-access"),$(".seamless-access-btn").removeClass("state-loading")},startLoading:function startLoading(){t.removeStates(),$(".seamless-access-btn").addClass("state-loading")},handleNoInstitutions:function handleNoInstitutions(){var e,s,n;t.removeStates(),$(".seamless-access-btn").addClass("state-no-institutions"),$(".seamless-access-btn").find("#seamless-access-institution-name").val(""),$(".seamless-access-btn").find("#entity-id").val("None"),$(".seamless-access-btn").find("#entitlement-check-result").val("ENTITY_ID_NONE"),$(".seamless-access-btn").off().on("click",(function(e){var s,n;e.preventDefault(),null===(s=(n=window).ga)||void 0===s||s.call(n,"send","event","Federated Access","click","Seamless Access"),t.seamlessAccessAnalyticAjax(),UX.userLogin.saveCurrentUrlCookie(),t.constructURLParams()})),(e=$(".accessDenialWidget .access .buttons a.purchase-access")).length>0&&!e.hasClass("clickBinded")&&t.showPurchaseAccessBtn(),(s=$("ul.signInLinks li.ppv-offers")).length>0&&s.show(),(n=$("ul.signInLinks li.restore-access")).length>0&&$("input[name='ppvLicenseType']").length>0&&n.show(),t.determineRecommendedSection(t.staticTexts.NoInst),t.setControlsMinHeight()},institutionDidNotProvideAccess:function institutionDidNotProvideAccess(e,s){var n;t.removeStates(),$(".seamless-access-btn").addClass("state-inst-did-not-provide-access"),$(".seamless-access-btn").find("#seamless-access-institution-name").val(e.entityTitle),$(".seamless-access-btn").find("#entity-id").val(e.entityID),$(".seamless-access-btn").find("#entitlement-check-result").val(s),$(".article_header-links .more-access").addClass("no-access"),0!==$(".access-not-available").length&&(n=(n=$(".access-not-available").html()).replace("{InstitutionName}",e.entityTitle),$(".access-not-available").html(n),$(".access-not-available").show()),t.determineRecommendedSection(t.staticTexts.instNoAccess),t.changeHeader(),t.injectInstitName(e.entityTitle),t.showNoAccessParagraph(),t.addNoAccesslistener(),t.handleAddOrChangeInstBtn()},moveSeamlessAccessBtnToHeader:function moveSeamlessAccessBtnToHeader(){var e=$(".accessDenialWidget .seamless-access-btn-container .access-denials__controls").children().clone(),s=$('<div class="seamless-access-btn-container"></div>');t.changeArticleGridLabel(e),s.append(e),e.length?(s.appendTo(".seamless-access-drop-area"),$(".seamless-access-drop-area").css("display","inline-block")):$(".article_header-links").addClass("no-space")},institutionProvideAccess:function institutionProvideAccess(e,s){t.removeStates(),$(".seamless-access-btn").addClass("state-inst-provide-access"),$(".seamless-access-btn").find(".inst-name").show(),$(".seamless-access-btn").find("#seamless-access-institution-name").val(e.entityTitle),$(".seamless-access-btn").find("#entity-id").val(e.entityID),$(".seamless-access-btn").find("#entitlement-check-result").val(s),$(".seamless-access-btn").on("click",(function(s){var n,i;s.preventDefault(),null===(n=(i=window).ga)||void 0===n||n.call(i,"send","event","Federated Access","click","Seamless Access"),t.seamlessAccessAnalyticAjax(),window.location.href=e.entitySsoUrl})),t.determineRecommendedSection(t.staticTexts.instGiveAccess),t.injectInstitName(e.entityTitle),t.handleAddOrChangeInstBtn()},handleAddOrChangeInstBtn:function handleAddOrChangeInstBtn(){var e=$(".add-or-change-inst");0!==e.length&&e.on("click",(function(e){e.preventDefault(),UX.userLogin.saveCurrentUrlCookie(),t.constructURLParams()}))},changeHeader:function changeHeader(){t.seamlessAccessCardHeader&&(t.seamlessAccessCardHeader.textContent=t.staticTexts.recommendedLabel)},addNoAccesslistener:function addNoAccesslistener(){document.querySelectorAll(".seamless-access-btn").forEach((function(e){null==e||e.addEventListener("click",t.handleRecommendedPublicationClick)}))},handleRecommendedPublicationClick:function handleRecommendedPublicationClick(){var e=window.location,s=e.protocol,n=e.host,i=e.pathname,c=e.search;window.location.href="".concat(t.staticTexts.recommendedUrl).concat(s,"//").concat(n).concat(i).concat(c)},showPurchaseAccessBtn:function showPurchaseAccessBtn(){var e=$(".ppv-offers a.add-article-to-cart"),s=$(".ppv-offers a.add-article-to-cart[href!='#']"),n=$(".ppv-offers .purchase-options-container .addedMessage");0===e.length&&(s=$(".ppv-offers .cart_content a[href!='#']").length?$(".ppv-offers .cart_content a[href!='#']"):$(".access-denials__controls .cart_content a[href!='#']")),t.newDenialPurchaseCard&&(e.length>0||n.length)?(t.newDenialPurchaseCard.classList.add("shown"),t.$purchseUrl=$(s[0]).attr("href")):(e.length>0||n.length>0)&&(t.$purchseUrl=$(s[0]).attr("href"),$("a.purchase-access").css("display","inline-block")),n.css("display","none"),$("a.purchase-access").on("click",(function(e){$(this).addClass("clickBinded"),0!==s.length&&(e.preventDefault(),window.location.href=t.$purchseUrl)})),t.showVerticalStroke()},showVerticalStroke:function showVerticalStroke(){var e,s=!(null!==(e=t.newDenialPurchaseCard)&&void 0!==e&&e.classList.contains("shown")),n=document.querySelector(".seamless-access-btn.state-inst-did-not-provide-access")&&document.querySelector(".no-ind-user-exists");if(t.newDenialPurchaseCard&&s&&!n){var i=document.querySelector(".access-denials__option.log-in")||document.querySelector(".access-denials__option.member.disabled");null==i||i.classList.add("show-stroke")}},hideRestoreAccessLink:function hideRestoreAccessLink(){var e=$(".restore-access"),s=$("input[name='ppvLicenseType']");0!==e.length&&0===s.length&&e.css("display","none")},seamlessAccessAnalyticAjax:function seamlessAccessAnalyticAjax(){$.ajax({type:"POST",url:"/action/seamlessAccessAnalytics",data:{doi:t.$pubDoi.val(),action:"click",seamlessAccessInstitutionName:$(".seamless-access-btn").find("#seamless-access-institution-name").val(),seamlessAccessEntityId:$(".seamless-access-btn").find("#entity-id").val(),EntitlementCheckResult:$(".seamless-access-btn").find("#entitlement-check-result").val()},success:function success(){},error:function error(){}})},determineRecommendedSection:function determineRecommendedSection(e){var s=document.querySelector(".accessDenialWidget .ind-user-exists");(!s&&e===t.staticTexts.NoInst||e===t.staticTexts.instGiveAccess)&&$(".seamless-access-btn-container").addClass("recommended"),s||e!==t.staticTexts.instNoAccess||$(".access-denials__option.log-in").addClass("recommended"),s&&e===t.staticTexts.instNoAccess&&($(".access-denials__option.purchase-access").addClass("show-label"),document.querySelector(".accessDenialWidget .perks")&&$(".access-denials__option.log-in").addClass("show-label")),e===t.staticTexts.instGiveAccess&&$(".seamless-access-btn-container").addClass("recommended"),s&&e===t.staticTexts.NoInst&&$(".seamless-access-btn-container").addClass("recommended"),t.setRecommendedData(),t.moveRecommendedDenialCard(),t.showHorizontalStroke()},setRecommendedData:function setRecommendedData(){t.recommendedChildIndex||(t.recommendedSection=document.querySelector(".access-denials__option.recommended"),t.siblingsElements=document.querySelectorAll(".access-denials__option"),t.siblings=Array.from(t.siblingsElements),t.recommendedChildIndex=t.siblings.indexOf(t.recommendedSection))},changeArticleGridLabel:function changeArticleGridLabel(e){var s=null==e?void 0:e.find(".access-not-provided");s.length&&s.text(t.staticTexts.accessNotProvidedLabel)},showNoAccessParagraph:function showNoAccessParagraph(){var e=document.querySelector(".seamless-access-btn-container p.state-inst-did-not-provide-access"),s=document.querySelector(".seamless-access-btn-container .content");e&&s&&(e.classList.add("shown"),s.classList.add("hidden"))},injectInstitName:function injectInstitName(e){e&&(t.staticTexts.instName=e,$(".seamless-access-btn").find(".inst-name").html(e),t.truncateInstName())},handleOrientationChange:function handleOrientationChange(){t.setControlsMinHeight(),t.truncateInstName()},truncateInstName:function truncateInstName(){t.staticTexts.instName.length>32&&$(".seamless-access-btn").find(".inst-name").text((function(e,s){return s.slice(0,32).trim()+"..."})),t.staticTexts.isMobile&&$(".seamless-access-btn").find(".inst-name").truncate({midWordEnabled:!0})},removeCotrolsMinHeight:function removeCotrolsMinHeight(){document.querySelectorAll(".access-denials__controls").forEach((function(e){e.style.minHeight=""}))},setControlsMinHeight:function setControlsMinHeight(){var e;if((null===(e=t.newDenialsWrapper)||void 0===e?void 0:e.getBoundingClientRect().width)<=t.staticTexts.containerBreakPoint)return t.removeCotrolsMinHeight();if(!t.staticTexts.isDesktop){var s=document.querySelectorAll(".access-denials__controls"),n=document.querySelectorAll(".access-denials__option"),i=0;s.forEach((function(e){i=e.clientHeight>i?e.clientHeight:i})),s.forEach((function(e){return e.style.minHeight="".concat(i,"px")})),i>66&&n.forEach((function(e){return e.classList.add("reduce-padding")}))}},constructURLParams:function constructURLParams(){var e,s,n,i,c={isDenialsRedirect:t.newDenialPurchaseCard?"true":"",purchaseUrl:t.$purchseUrl?t.$purchseUrl:"",redirectUri:encodeURI($.cookie("SSO_URL_BEFORE_LOGIN")),isLoggedIn:document.querySelector(".no-ind-user-exists")?"logged-out":"logged-in",memberLabel:null===(e=document.querySelector("#member-label"))||void 0===e?void 0:e.value,showAgreement:null===(s=document.querySelector("#show-agreement"))||void 0===s?void 0:s.value,remainingAllowance:null===(n=document.querySelector("#remaining-allowance"))||void 0===n?void 0:n.value,doAllowanceLicenseServiceUrl:null===(i=document.querySelector(".allowance-hidden-link"))||void 0===i?void 0:i.href},a=t.buildUrlWithParams(c);window.location.href=a},buildUrlWithParams:function buildUrlWithParams(e){var s=[];for(var t in e)""!==e[t]&&void 0!==e[t]&&s.push("".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e[t])));return"/action/ssostart?".concat(s.join("&"))},moveRecommendedDenialCard:function moveRecommendedDenialCard(){var e;if(t.setControlsMinHeight(),t.newDenialPurchaseCard&&t.recommendedSection){var s=t.recommendedSection.closest(".buttons"),n=(null===(e=t.newDenialsWrapper)||void 0===e?void 0:e.getBoundingClientRect()).width;t.firstCardChild||(t.firstCardChild=t.siblings[0]),n<=t.staticTexts.containerBreakPoint?s.insertBefore(t.recommendedSection,t.firstCardChild):s.insertBefore(t.recommendedSection,t.siblings[t.recommendedChildIndex+1])}},showHorizontalStroke:function showHorizontalStroke(){var e=t.siblings.slice(0,-1);switch(t.recommendedChildIndex){case 2:t.siblings[0].classList.add("show-stroke-horizontal");break;case-1:e.forEach((function(e){return e.classList.add("show-stroke-horizontal")}))}}},UX.accessDenial=t},285:function(e,s){var t;t={$eCommerceCheckoutFieldsWidget:document.querySelector(".eCommerceCheckoutFieldsWidget"),$returningUserBtnClass:"returningUser",init:function init(){t.control()},control:function control(){t.addEventListener(),t.safariBtnBackCaching()},addEventListener:function addEventListener(){var e;null===(e=t.$eCommerceCheckoutFieldsWidget)||void 0===e||e.addEventListener("click",t.saveUrlCookieCallBack)},saveUrlCookieCallBack:function saveUrlCookieCallBack(e){e.target.classList.contains(t.$returningUserBtnClass)&&UX.userLogin.saveCurrentUrlCookie()},safariBtnBackCaching:function safariBtnBackCaching(){window.onpageshow=function(e){e.persisted&&window.location.reload()}}},UX.returnUser=t},286:function(e,s){$(window).on("pageshow",(function(e){$(".loading-overlay").length&&e.originalEvent.persisted&&window.location.reload()}))}}]);
//# sourceMappingURL=commerce-203344afc146459ff2f3.js.map